import{d as ee,u as te,r as x,v as se,J as ae,b as le,c as r,y as w,a,E as U,G as oe,t as p,F as k,i as C,z as M,e as ne,w as re,q,K as ie,k as de,l as ce,s as R,p as L,n as ue,o as i,_ as ve}from"./index-B-8m7vOr.js";import{S as pe}from"./SongMenu-Bd5b6pCI.js";const me={class:"relative min-h-full bg-background-base"},fe={class:"relative z-10 px-4 sm:px-6 md:px-8 pt-6 sm:pt-8 pb-4 sm:pb-6 flex flex-col md:flex-row items-end gap-5 sm:gap-6"},xe={class:"size-[160px] sm:size-[192px] md:size-[232px] shrink-0 shadow-[0_8px_40px_rgba(0,0,0,0.5)] flex items-center justify-center rounded-lg overflow-hidden bg-white/5"},he=["src","alt"],ge={key:1,class:"w-full h-full flex items-center justify-center"},be={key:0,class:"material-symbols-outlined text-white/30 text-[60px] animate-pulse"},ye={key:1,class:"material-symbols-outlined text-white/30 text-[60px]"},_e={class:"flex flex-col gap-2 w-full pb-2"},we={key:0,class:"text-2xl sm:text-3xl md:text-[72px] lg:text-[86px] md:leading-none font-black tracking-tighter text-white mb-2 line-clamp-2"},ke={key:1,class:"h-16 md:h-24 bg-white/5 rounded-lg w-3/4 skeleton"},Ce={key:2,class:"text-white/70 text-sm font-medium"},ze={key:3,class:"flex items-center gap-1 mt-2 text-sm font-bold flex-wrap"},Se={class:"text-white/70 font-normal"},je={class:"relative z-10 px-4 sm:px-6 md:px-8 py-4 sm:py-6 bg-background-base/30 backdrop-blur-sm md:sticky md:top-0"},Me={class:"flex items-center justify-between flex-wrap gap-4"},Te={class:"flex items-center gap-4 md:gap-6"},Pe=["disabled"],Ie=["disabled"],$e={class:"flex items-center gap-2"},Ae={class:"flex items-center bg-white/10 rounded-full p-1"},Ne=["onClick"],Ue={class:"relative z-10 px-4 sm:px-6 md:px-8 py-4 border-b border-white/10"},qe=["onClick"],Re={key:1,class:"px-4 sm:px-6 md:px-8 pb-32 flex flex-col gap-1"},Le={key:2,class:"px-4 sm:px-6 md:px-8 pb-32 flex flex-col gap-1"},Ve=["onClick"],De={class:"flex items-center justify-center text-white/50 font-medium text-base w-full"},Qe={class:"flex items-center gap-4 overflow-hidden"},Fe=["src","alt"],Be={key:1,class:"size-10 rounded bg-white/5 flex items-center justify-center shrink-0"},Ee={class:"flex flex-col truncate pr-2"},Ge={class:"text-white font-medium truncate text-base mb-0.5"},Je={class:"text-sm text-white/50 group-hover:text-white/80 hover:underline truncate transition-colors"},Ke={class:"hidden md:block text-white/50 text-sm group-hover:text-white/80 hover:underline truncate transition-colors"},He={class:"hidden md:block justify-self-end text-white/50 text-sm tabular-nums"},Oe={class:"flex items-center gap-1"},We=["onClick"],Xe={key:0,class:"flex flex-col items-center justify-center py-20 text-white/50"},Ye=ee({name:"ChartsView",__name:"ChartsView",setup(Ze){const f=te(),y=ie(),T=[{id:"netease",name:"网易云"},{id:"kuwo",name:"酷我"},{id:"qq",name:"QQ音乐"}],v=x("netease"),h=x([]),m=x(null),d=x([]),u=x(!1),g=x("#121212"),P=x(null),V=x(null),D=e=>{const t=e.id??e.songId??e.song_id??e.rid??e.musicId??e.mid??e.musicrid??e.musicRid??e.hash;return t?String(t):""},Q=e=>e.name||e.songName||e.song_name||e.title||"未知歌曲",F=(e,t,l)=>{if(t==="kuwo"&&l)return L(l,t);const s=[e.pic,e.coverUrl,e.cover,e.image,e.img,e.picUrl,e.pic_url,e.pic120,e.pic300,e.albumPic,e.album_pic].find(c=>typeof c=="string"&&c.trim().length>0),o=ue(s);if(o)return o;if(l)return L(l,t)},B=e=>e.artist?e.artist:e.singer?e.singer:e.singerName?e.singerName:e.author?e.author:Array.isArray(e.artists)&&e.artists.length>0?e.artists.map(t=>t.name||t).join(" / "):Array.isArray(e.ar)&&e.ar.length>0?e.ar.map(t=>t.name||t).join(" / "):"未知歌手",E=e=>{var t,l;return e.album||e.albumName||((t=e.al)==null?void 0:t.name)||((l=e.album)==null?void 0:l.name)},G=e=>q(e.duration??e.time??e.dt??e.length??e.songTime),z=se(()=>d.value.length>0&&d.value[0].coverUrl?d.value[0].coverUrl:null),J=e=>{const t=q(e);if(!t||t<=0)return"-";const l=Math.floor(t/60),n=Math.floor(t%60);return`${l}:${n.toString().padStart(2,"0")}`},K=e=>({netease:"网易云音乐",kuwo:"酷我音乐",qq:"QQ音乐"})[e],I=()=>{const e=y.query.platform;return typeof e!="string"?null:T.some(t=>t.id===e)?e:null},$=()=>{const e=y.query.toplistId;return typeof e!="string"?null:e.trim()?e:null},H=()=>{const e=P.value;if(e)try{const t=document.createElement("canvas"),l=t.getContext("2d");if(!l)return;t.width=50,t.height=50,l.drawImage(e,0,0,50,50);const n=l.getImageData(0,0,50,50).data;let s=0,o=0,c=0,_=0;for(let b=0;b<n.length;b+=16)s+=n[b],o+=n[b+1],c+=n[b+2],_++;s=Math.floor(s/_),o=Math.floor(o/_),c=Math.floor(c/_);const N=(s*299+o*587+c*114)/1e3;N>180?(s=Math.floor(s*.6),o=Math.floor(o*.6),c=Math.floor(c*.6)):N<30&&(s=Math.min(255,s+40),o=Math.min(255,o+40),c=Math.min(255,c+40)),g.value=`rgb(${s}, ${o}, ${c})`}catch{g.value="#121212"}},A=async(e,t)=>{e!==v.value&&(v.value=e,g.value="#121212",m.value=null,await S(t||void 0))},S=async e=>{u.value=!0,d.value=[];try{if(h.value=await de(v.value),h.value.length>0){const t=e?h.value.find(l=>l.id===e):null;await j(t||h.value[0])}}catch(t){console.error("Failed to load toplists:",t)}finally{u.value=!1}},O=async()=>{const e=I(),t=$();if(e&&e!==v.value){await A(e,t);return}if(t){if(h.value.length===0){await S(t);return}const l=h.value.find(n=>n.id===t);l&&await j(l)}},j=async e=>{var t;if(((t=m.value)==null?void 0:t.id)!==e.id){m.value=e,u.value=!0,d.value=[],g.value="#121212";try{const l=await ce(e.id,v.value);d.value=l.map(n=>{const s=D(n),o=F(n,v.value,s);return{id:s,platform:v.value,name:Q(n),artist:B(n),album:E(n),duration:G(n),coverUrl:o}})}catch(l){console.error("Failed to load toplist songs:",l)}finally{u.value=!1}}},W=(e,t)=>{const l=d.value.findIndex(s=>s.id===e.id&&s.platform===e.platform),n=l>=0?l:t;f.clearPlaylist(),f.addToPlaylist(d.value),f.playAt(n)},X=e=>{f.addToPlaylist(e),R.success("已添加到播放列表")},Y=()=>{d.value.length>0&&(f.clearPlaylist(),f.addToPlaylist(d.value),f.playAt(0))},Z=()=>{d.value.length>0&&(f.addToPlaylist(d.value),R.success("已添加到播放列表"))};return ae(()=>[y.query.platform,y.query.toplistId],()=>{O()}),le(()=>{const e=I();e&&(v.value=e),S($()||void 0)}),(e,t)=>{var l,n;return i(),r("div",me,[!u.value&&z.value?(i(),r("div",{key:0,class:"absolute top-0 left-0 w-full h-[340px] z-0 pointer-events-none opacity-80 transition-colors duration-700",style:oe({background:`linear-gradient(180deg, ${g.value} 0%, #121212 100%)`})},null,4)):w("",!0),a("div",fe,[a("div",xe,[z.value&&!u.value?(i(),r("img",{key:0,ref_key:"coverImgRef",ref:P,src:z.value,alt:(l=m.value)==null?void 0:l.name,class:"w-full h-full object-cover",onLoad:H},null,40,he)):(i(),r("div",ge,[u.value?(i(),r("span",be,"music_note")):(i(),r("span",ye,"trophy"))]))]),a("div",_e,[t[2]||(t[2]=a("span",{class:"text-xs font-bold uppercase tracking-wider mt-4 md:mt-0 hidden md:block text-white/60"},"排行榜",-1)),(n=m.value)!=null&&n.name?(i(),r("h1",we,p(m.value.name),1)):(i(),r("div",ke)),m.value?(i(),r("p",Ce,p(K(v.value))+" 上目前播放次数最多的歌曲。每日更新。",1)):w("",!0),m.value?(i(),r("div",ze,[t[0]||(t[0]=a("div",{class:"bg-primary text-black size-6 rounded-full flex items-center justify-center text-[10px] font-black"},"L",-1)),t[1]||(t[1]=a("span",{class:"hover:underline cursor-pointer"},"LinMusic",-1)),a("span",Se,"• "+p(d.value.length)+" 首歌曲",1)])):w("",!0)])]),a("div",je,[a("div",Me,[a("div",Te,[a("button",{class:"btn-play size-14 shadow-lg",disabled:u.value||d.value.length===0,onClick:Y},[...t[3]||(t[3]=[a("span",{class:"material-symbols-outlined text-[32px] fill-1"},"play_arrow",-1)])],8,Pe),a("button",{class:"btn-icon text-white/50 hover:text-white",title:"添加到播放列表",disabled:u.value||d.value.length===0,onClick:Z},[...t[4]||(t[4]=[a("span",{class:"material-symbols-outlined text-[28px]"},"playlist_add",-1)])],8,Ie)]),a("div",$e,[t[5]||(t[5]=a("span",{class:"text-xs font-bold text-white/50 uppercase tracking-widest mr-2 hidden sm:block"},"平台",-1)),a("div",Ae,[(i(),r(k,null,C(T,s=>a("button",{key:s.id,class:M(["px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200",v.value===s.id?"bg-white text-black shadow-sm":"text-white/70 hover:text-white hover:bg-white/5"]),onClick:o=>A(s.id)},p(s.name),11,Ne)),64))])])])]),a("div",Ue,[a("div",{ref_key:"toplistScrollRef",ref:V,class:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-thin",style:{"-webkit-overflow-scrolling":"touch"}},[(i(!0),r(k,null,C(h.value,s=>{var o;return i(),r("button",{key:s.id,class:M(["px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all duration-200 flex-shrink-0",((o=m.value)==null?void 0:o.id)===s.id?"bg-white text-black":"bg-white/10 text-white/70 hover:bg-white/20 hover:text-white"]),onClick:c=>j(s)},p(s.name),11,qe)}),128))],512)]),t[11]||(t[11]=U('<div class="px-4 sm:px-6 md:px-8 bg-background-base border-b border-white/10 pb-2 pt-2 mb-2" data-v-c9ec6193><div class="grid grid-cols-[16px_1fr_40px] md:grid-cols-[16px_4fr_3fr_minmax(60px,1fr)] gap-4 text-sm font-normal text-white/50 items-center px-4" data-v-c9ec6193><div class="text-center text-base" data-v-c9ec6193>#</div><div class="text-xs font-medium uppercase tracking-wider" data-v-c9ec6193>标题</div><div class="hidden md:block text-xs font-medium uppercase tracking-wider" data-v-c9ec6193>专辑</div><div class="justify-self-end" data-v-c9ec6193><span class="material-symbols-outlined text-[18px]" data-v-c9ec6193>schedule</span></div></div></div>',1)),u.value?(i(),r("div",Re,[(i(),r(k,null,C(10,s=>a("div",{key:s,class:"grid grid-cols-[16px_1fr_40px] md:grid-cols-[16px_4fr_3fr_minmax(60px,1fr)] gap-4 items-center px-4 py-2"},[...t[6]||(t[6]=[U('<div class="flex items-center justify-center" data-v-c9ec6193><div class="w-4 h-4 bg-white/10 rounded skeleton" data-v-c9ec6193></div></div><div class="flex items-center gap-4" data-v-c9ec6193><div class="size-10 rounded bg-white/10 skeleton" data-v-c9ec6193></div><div class="flex flex-col gap-2 flex-1" data-v-c9ec6193><div class="h-4 bg-white/10 rounded w-3/4 skeleton" data-v-c9ec6193></div><div class="h-3 bg-white/10 rounded w-1/2 skeleton" data-v-c9ec6193></div></div></div><div class="hidden md:block" data-v-c9ec6193><div class="h-3 bg-white/10 rounded w-2/3 skeleton" data-v-c9ec6193></div></div><div class="justify-self-end" data-v-c9ec6193><div class="h-3 bg-white/10 rounded w-10 skeleton" data-v-c9ec6193></div></div>',4)])])),64))])):(i(),r("div",Le,[(i(!0),r(k,null,C(d.value,(s,o)=>(i(),r("div",{key:`${s.platform}-${s.id}`,class:"song-row group grid grid-cols-[16px_1fr_auto] md:grid-cols-[16px_4fr_3fr_minmax(60px,1fr)_auto] gap-4 items-center px-4 py-2 cursor-pointer",onClick:c=>W(s,o)},[a("div",De,[a("span",{class:M(["rank-num",{"text-primary font-bold":o<3}])},p(o+1),3),t[7]||(t[7]=a("span",{class:"rank-play text-white material-symbols-outlined text-[20px] fill-1"},"play_arrow",-1))]),a("div",Qe,[s.coverUrl?(i(),r("img",{key:0,src:s.coverUrl,alt:s.name,class:"size-10 rounded shadow-sm object-cover shrink-0",loading:"lazy"},null,8,Fe)):(i(),r("div",Be,[...t[8]||(t[8]=[a("span",{class:"material-symbols-outlined text-white/30"},"music_note",-1)])])),a("div",Ee,[a("span",Ge,p(s.name),1),a("span",Je,p(s.artist),1)])]),a("div",Ke,p(s.album||"-"),1),a("div",He,p(J(s.duration)),1),a("div",Oe,[a("button",{class:"btn-icon text-white/30 hover:text-white opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-all duration-200",title:"添加到播放列表",onClick:re(c=>X(s),["stop"])},[...t[9]||(t[9]=[a("span",{class:"material-symbols-outlined text-[20px]"},"playlist_add",-1)])],8,We),ne(pe,{song:s,"button-class":"opacity-100 md:opacity-0 md:group-hover:opacity-100"},null,8,["song"])])],8,Ve))),128)),d.value.length===0&&!u.value?(i(),r("div",Xe,[...t[10]||(t[10]=[a("span",{class:"material-symbols-outlined text-6xl mb-4"},"music_off",-1),a("p",null,"暂无歌曲",-1)])])):w("",!0)]))])}}}),st=ve(Ye,[["__scopeId","data-v-c9ec6193"]]);export{st as default};
